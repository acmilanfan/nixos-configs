#!/usr/bin/env bash
set -e

# 1. Get details of the currently FOCUSED window
active_win=$(hyprctl activewindow -j)
cur_mon_id=$(echo "$active_win" | jq -r '.monitor')
is_pinned=$(echo "$active_win" | jq -r '.pinned')
title=$(echo "$active_win" | jq -r '.title')

# 2. Find the "Other" Monitor
# Logic: List all monitors, ignore the one with the current ID, pick the first remaining one.
target_mon_name=$(hyprctl monitors -j | jq -r --argjson cur "$cur_mon_id" '.[] | select(.id != $cur) | .name' | head -n1)

# If no other monitor exists, exit
if [[ -z "$target_mon_name" ]]; then
    exit 0
fi

# 3. Execute Move
if [[ "$is_pinned" == "true" ]]; then
    # Pinned windows must be moved by Monitor Name
    hyprctl dispatch movewindow mon:"$target_mon_name"
else
    # Standard windows move to the Active Workspace of the target monitor
    target_ws=$(hyprctl monitors -j | jq -r --arg name "$target_mon_name" '.[] | select(.name == $name) | .activeWorkspace.id')
    hyprctl dispatch movetoworkspace "$target_ws"
fi

# 4. Safety Net: Ensure PiP stays visible
# If we just moved the PiP window, force it to a safe coordinate (Top-Right)
if [[ "$title" == "Picture-in-Picture" ]]; then
    hyprctl dispatch movewindowpixel exact 65% 5%
fi
